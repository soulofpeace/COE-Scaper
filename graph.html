<!doctype>
<head>

  <link type="text/css" rel="stylesheet" href="stylesheets/bootstrap.min.css">
  <link type="text/css" rel="stylesheet" href="stylesheets/bootstrap-responsive.min.css">


</head>
<body>

  <div class="container">
    <div class="page-header">
      COE Prices
    </div>
    <div class="row-fluid">
      <div class="span8" id="a_chart" style="width: 900px; height: 500px;"></div>
    </div>
    <div class="row-fluid">
      <div class="span8" id="b_chart" style="width: 900px; height: 500px;"></div>
    </div>
    <div class="row-fluid">
      <div class="span8" id="c_chart" style="width: 900px; height: 500px;"></div>
    </div>
    <div class="row-fluid">
      <div class="span8" id="d_chart" style="width: 900px; height: 500px;"></div>
    </div>
    <div class="row-fluid">
      <div class="span8" id="e_chart" style="width: 900px; height: 500px;"></div>
    </div>
  </div>

  <script src="javascripts/jquery.min.js"></script>
  <script src="javascripts/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script src="data/coe.js"></script>
  <script>

  google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(draw_all_charts);


  var get_cat_data = function(data, category){

    rows = []
    rows.push(["Date", "Quota", "Received Bids", "Successful Bids", "Premium"])
    sorted_keys = []
    for(var key in data[category]){
      sorted_keys.push(key);
    }
    sorted_keys.sort();
    for(i = 0; i< sorted_keys.length; i ++){
      var key = sorted_keys[i];
      var value = data[category][key];
      row = [key,
        parseInt(value["quota"].replace(",", "")),
        parseInt(value["received"].replace(",", "")),
        parseInt(value["successful"].replace(",", "")),
        parseInt(value["premium"].replace(",", "").substring(1))];
      rows.push(row);
    };
    return rows;
  };
  
  function draw_all_charts(){
    drawChart("A");
    drawChart("B");
    drawChart("C");
    drawChart("D");
    drawChart("E");
  }
  function drawChart(category){
    var chart = new google.visualization.AreaChart(document.getElementById(category.toLowerCase()+'_chart'));
    var options = {
      title: 'COE Category '+category.toUpperCase(),
      hAxis: {title: 'Date',  titleTextStyle: {color: 'red'}}
    };
    var datatable = google.visualization.arrayToDataTable(
      get_cat_data(data, category)
      );
    chart.draw(datatable, options);
  }

  </script>

</body>
